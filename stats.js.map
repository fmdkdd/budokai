{"version":3,"sources":["stats.es6"],"names":[],"mappings":"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","file":"stats.js","sourcesContent":["document.addEventListener('DOMContentLoaded', init);\n\nfunction init() {\n  var matches = [];\n  var namesDict = {};\n  window.stats.forEach(s => s.events.forEach(e => {\n    e.forEach(m => {\n      namesDict[m.p1.name] = true;\n      namesDict[m.p2.name] = true;\n      matches.push(m);\n    });\n  }));\n  var names = Object.getOwnPropertyNames(namesDict).sort();\n\n  var matrix = computeMatchesMatrix(matches, names);\n  refreshMatches(names, matrix);\n}\n\nfunction refreshMatches(names, matrix) {\n  var frag = document.createDocumentFragment();\n\n  var quantize = d3.scale.quantize()\n    .domain([d3.min(matrix, r => d3.min(r)),\n             d3.max(matrix, r => d3.max(r))])\n    .range(d3.range(5).map(i => \"q\" + i));\n\n  var chart = d3.select('#all-matches');\n\n  chart.append('thead')\n    .append('tr')\n    .selectAll('td')\n      .data(names)\n    .enter().append('td')\n    .text(d => d);\n\n  chart.select('thead tr')\n    .insert('td', ':first-child');\n\n  chart.append('tbody')\n    .selectAll('tr')\n    .data(matrix)\n    .enter().append('tr')\n    .each(makeRow);\n\n  function makeRow(row, y) {\n    d3.select(this)\n      .selectAll('td')\n        .data(row)\n      .enter().append('td')\n        .attr('data-x', (d,x) => x)\n        .attr('data-y', _ => y)\n        .attr('class', d => 'square ' + quantize(d))\n        .on('mouseenter', highlightLabels)\n        .append('span')\n          .attr('class', 'delta-score')\n          .text(d => d);\n\n    d3.select(this)\n      .insert('td', ':first-child')\n      .attr('class', 'name')\n      .text(names[y]);\n  }\n\n  document.querySelector('#all-matches tbody')\n    .addEventListener('mouseleave', unhighlightLabels);\n\n  function highlightLabels() {\n    var target = this;\n    chart.selectAll('.square')\n      .classed('inactive', function() {\n        return !((this.getAttribute('data-y') === target.getAttribute('data-y')\n                  && this.getAttribute('data-x') === target.getAttribute('data-x'))\n                 || (this.getAttribute('data-x') === target.getAttribute('data-y')\n                     && this.getAttribute('data-y') === target.getAttribute('data-x')))\n      });\n\n    var x = parseInt(this.getAttribute('data-x'), 10);\n    chart.selectAll('thead td').classed('active', (d, i) => x == i - 1);\n    var y = parseInt(this.getAttribute('data-y'), 10);\n    chart.selectAll('.name').classed('active', (d, i) => y == i);\n  }\n\n  function unhighlightLabels() {\n    chart.selectAll('.inactive').classed('inactive', false);\n  }\n}\n\nfunction computeMatchesMatrix(matches, names) {\n  var matrix = [];\n\n  // Fill matrix with zeroes\n  var l = names.length;\n  for (var i = 0; i < l; ++i) {\n    matrix[i] = [];\n    for (var j = 0; j < l; ++j) {\n      matrix[i][j] = i === j ? '' : 0;\n    }\n  }\n\n  // Count victories\n  matches.forEach(m => {\n    var p1 = names.indexOf(m.p1.name);\n    var p2 = names.indexOf(m.p2.name);\n\n    if (m.winner === 'p1') {\n      matrix[p1][p2] += 1;\n    } else {\n      matrix[p2][p1] += 1;\n    }\n  });\n\n  // Normalize victories\n  for (var i = 0; i < l; ++i) {\n    for (var j = 0; j < i; ++j) {\n      var totalMatches = matrix[i][j] + matrix[j][i];\n      if (totalMatches > 10) {\n        matrix[i][j] *= 10 / totalMatches;\n        matrix[j][i] *= 10 / totalMatches;\n        matrix[i][j] = Math.round(matrix[i][j] * 10) / 10;\n        matrix[j][i] = Math.round(matrix[j][i] * 10) / 10;\n      }\n    }\n  }\n\n  return matrix;\n}\n"]}