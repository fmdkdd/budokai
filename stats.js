document.addEventListener("DOMContentLoaded", init);

function init() {
  var matches = [];
  var namesDict = {};
  window.stats.forEach(function (s) {
    return s.events.forEach(function (e) {
      e.forEach(function (m) {
        namesDict[m.p1.name] = true;
        namesDict[m.p2.name] = true;
        matches.push(m);
      });
    });
  });
  var names = Object.getOwnPropertyNames(namesDict).sort();

  var matrix = computeMatchesMatrix(matches, names);
  refreshMatches(names, matrix);
}

function refreshMatches(names, matrix) {
  var frag = document.createDocumentFragment();

  var quantize = d3.scale.quantize().domain([d3.min(matrix, function (r) {
    return d3.min(r);
  }), d3.max(matrix, function (r) {
    return d3.max(r);
  })]).range(d3.range(5).map(function (i) {
    return "q" + i;
  }));

  var chart = d3.select("#all-matches");

  chart.append("thead").append("tr").selectAll("td").data(names).enter().append("td").text(function (d) {
    return d;
  });

  chart.select("thead tr").insert("td", ":first-child");

  chart.append("tbody").selectAll("tr").data(matrix).enter().append("tr").each(makeRow);

  function makeRow(row, y) {
    d3.select(this).selectAll("td").data(row).enter().append("td").attr("data-x", function (d, x) {
      return x;
    }).attr("data-y", function (_) {
      return y;
    }).attr("class", function (d) {
      return "square " + quantize(d);
    }).on("mouseenter", highlightLabels).append("span").attr("class", "delta-score").text(function (d) {
      return d;
    });

    d3.select(this).insert("td", ":first-child").attr("class", "name").text(names[y]);
  }

  document.querySelector("#all-matches tbody").addEventListener("mouseleave", unhighlightLabels);

  function highlightLabels() {
    var target = this;
    chart.selectAll(".square").classed("inactive", function () {
      return !(this.getAttribute("data-y") === target.getAttribute("data-y") && this.getAttribute("data-x") === target.getAttribute("data-x") || this.getAttribute("data-x") === target.getAttribute("data-y") && this.getAttribute("data-y") === target.getAttribute("data-x"));
    });

    var x = parseInt(this.getAttribute("data-x"), 10);
    chart.selectAll("thead td").classed("active", function (d, i) {
      return x == i - 1;
    });
    var y = parseInt(this.getAttribute("data-y"), 10);
    chart.selectAll(".name").classed("active", function (d, i) {
      return y == i;
    });
  }

  function unhighlightLabels() {
    chart.selectAll(".inactive").classed("inactive", false);
  }
}

function computeMatchesMatrix(matches, names) {
  var matrix = [];

  // Fill matrix with zeroes
  var l = names.length;
  for (var i = 0; i < l; ++i) {
    matrix[i] = [];
    for (var j = 0; j < l; ++j) {
      matrix[i][j] = i === j ? "" : 0;
    }
  }

  // Count victories
  matches.forEach(function (m) {
    var p1 = names.indexOf(m.p1.name);
    var p2 = names.indexOf(m.p2.name);

    if (m.winner === "p1") {
      matrix[p1][p2] += 1;
    } else {
      matrix[p2][p1] += 1;
    }
  });

  // Normalize victories
  for (var i = 0; i < l; ++i) {
    for (var j = 0; j < i; ++j) {
      var totalMatches = matrix[i][j] + matrix[j][i];
      if (totalMatches > 10) {
        matrix[i][j] *= 10 / totalMatches;
        matrix[j][i] *= 10 / totalMatches;
        matrix[i][j] = Math.round(matrix[i][j] * 10) / 10;
        matrix[j][i] = Math.round(matrix[j][i] * 10) / 10;
      }
    }
  }

  return matrix;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0YXRzLmVzNiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxRQUFRLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLENBQUM7O0FBRXBELFNBQVMsSUFBSSxHQUFHO0FBQ2QsTUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDO0FBQ2pCLE1BQUksU0FBUyxHQUFHLEVBQUUsQ0FBQztBQUNuQixRQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUM7V0FBSSxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUMsRUFBSTtBQUM5QyxPQUFDLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQyxFQUFJO0FBQ2IsaUJBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQztBQUM1QixpQkFBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDO0FBQzVCLGVBQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7T0FDakIsQ0FBQyxDQUFDO0tBQ0osQ0FBQztHQUFBLENBQUMsQ0FBQztBQUNKLE1BQUksS0FBSyxHQUFHLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQzs7QUFFekQsTUFBSSxNQUFNLEdBQUcsb0JBQW9CLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ2xELGdCQUFjLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0NBQy9COztBQUVELFNBQVMsY0FBYyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUU7QUFDckMsTUFBSSxJQUFJLEdBQUcsUUFBUSxDQUFDLHNCQUFzQixFQUFFLENBQUM7O0FBRTdDLE1BQUksUUFBUSxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQy9CLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLFVBQUEsQ0FBQztXQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0dBQUEsQ0FBQyxFQUM5QixFQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxVQUFBLENBQUM7V0FBSSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztHQUFBLENBQUMsQ0FBQyxDQUFDLENBQ3hDLEtBQUssQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUM7V0FBSSxHQUFHLEdBQUcsQ0FBQztHQUFBLENBQUMsQ0FBQyxDQUFDOztBQUV4QyxNQUFJLEtBQUssR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDOztBQUV0QyxPQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUNsQixNQUFNLENBQUMsSUFBSSxDQUFDLENBQ1osU0FBUyxDQUFDLElBQUksQ0FBQyxDQUNiLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FDYixLQUFLLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQ3BCLElBQUksQ0FBQyxVQUFBLENBQUM7V0FBSSxDQUFDO0dBQUEsQ0FBQyxDQUFDOztBQUVoQixPQUFLLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUNyQixNQUFNLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQyxDQUFDOztBQUVoQyxPQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUNsQixTQUFTLENBQUMsSUFBSSxDQUFDLENBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUNaLEtBQUssRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FDcEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDOztBQUVqQixXQUFTLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFO0FBQ3ZCLE1BQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQ1osU0FBUyxDQUFDLElBQUksQ0FBQyxDQUNiLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FDWCxLQUFLLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQ2xCLElBQUksQ0FBQyxRQUFRLEVBQUUsVUFBQyxDQUFDLEVBQUMsQ0FBQzthQUFLLENBQUM7S0FBQSxDQUFDLENBQzFCLElBQUksQ0FBQyxRQUFRLEVBQUUsVUFBQSxDQUFDO2FBQUksQ0FBQztLQUFBLENBQUMsQ0FDdEIsSUFBSSxDQUFDLE9BQU8sRUFBRSxVQUFBLENBQUM7YUFBSSxTQUFTLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQztLQUFBLENBQUMsQ0FDM0MsRUFBRSxDQUFDLFlBQVksRUFBRSxlQUFlLENBQUMsQ0FDakMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUNaLElBQUksQ0FBQyxPQUFPLEVBQUUsYUFBYSxDQUFDLENBQzVCLElBQUksQ0FBQyxVQUFBLENBQUM7YUFBSSxDQUFDO0tBQUEsQ0FBQyxDQUFDOztBQUVwQixNQUFFLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUNaLE1BQU0sQ0FBQyxJQUFJLEVBQUUsY0FBYyxDQUFDLENBQzVCLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQ3JCLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztHQUNuQjs7QUFFRCxVQUFRLENBQUMsYUFBYSxDQUFDLG9CQUFvQixDQUFDLENBQ3pDLGdCQUFnQixDQUFDLFlBQVksRUFBRSxpQkFBaUIsQ0FBQyxDQUFDOztBQUVyRCxXQUFTLGVBQWUsR0FBRztBQUN6QixRQUFJLE1BQU0sR0FBRyxJQUFJLENBQUM7QUFDbEIsU0FBSyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FDdkIsT0FBTyxDQUFDLFVBQVUsRUFBRSxZQUFXO0FBQzlCLGFBQU8sRUFBRSxBQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLEtBQUssTUFBTSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsSUFDMUQsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsS0FBSyxNQUFNLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxJQUM3RCxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxLQUFLLE1BQU0sQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLElBQzFELElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLEtBQUssTUFBTSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxBQUFDLENBQUE7S0FDaEYsQ0FBQyxDQUFDOztBQUVMLFFBQUksQ0FBQyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ2xELFNBQUssQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxVQUFDLENBQUMsRUFBRSxDQUFDO2FBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO0tBQUEsQ0FBQyxDQUFDO0FBQ3BFLFFBQUksQ0FBQyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ2xELFNBQUssQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxVQUFDLENBQUMsRUFBRSxDQUFDO2FBQUssQ0FBQyxJQUFJLENBQUM7S0FBQSxDQUFDLENBQUM7R0FDOUQ7O0FBRUQsV0FBUyxpQkFBaUIsR0FBRztBQUMzQixTQUFLLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7R0FDekQ7Q0FDRjs7QUFFRCxTQUFTLG9CQUFvQixDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUU7QUFDNUMsTUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDOzs7QUFHaEIsTUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztBQUNyQixPQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFO0FBQzFCLFVBQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDZixTQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFO0FBQzFCLFlBQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7S0FDakM7R0FDRjs7O0FBR0QsU0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUMsRUFBSTtBQUNuQixRQUFJLEVBQUUsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDbEMsUUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDOztBQUVsQyxRQUFJLENBQUMsQ0FBQyxNQUFNLEtBQUssSUFBSSxFQUFFO0FBQ3JCLFlBQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDckIsTUFBTTtBQUNMLFlBQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDckI7R0FDRixDQUFDLENBQUM7OztBQUdILE9BQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUU7QUFDMUIsU0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRTtBQUMxQixVQUFJLFlBQVksR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQy9DLFVBQUksWUFBWSxHQUFHLEVBQUUsRUFBRTtBQUNyQixjQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxHQUFHLFlBQVksQ0FBQztBQUNsQyxjQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxHQUFHLFlBQVksQ0FBQztBQUNsQyxjQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQ2xELGNBQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUM7T0FDbkQ7S0FDRjtHQUNGOztBQUVELFNBQU8sTUFBTSxDQUFDO0NBQ2YiLCJmaWxlIjoic3RhdHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgaW5pdCk7XG5cbmZ1bmN0aW9uIGluaXQoKSB7XG4gIHZhciBtYXRjaGVzID0gW107XG4gIHZhciBuYW1lc0RpY3QgPSB7fTtcbiAgd2luZG93LnN0YXRzLmZvckVhY2gocyA9PiBzLmV2ZW50cy5mb3JFYWNoKGUgPT4ge1xuICAgIGUuZm9yRWFjaChtID0+IHtcbiAgICAgIG5hbWVzRGljdFttLnAxLm5hbWVdID0gdHJ1ZTtcbiAgICAgIG5hbWVzRGljdFttLnAyLm5hbWVdID0gdHJ1ZTtcbiAgICAgIG1hdGNoZXMucHVzaChtKTtcbiAgICB9KTtcbiAgfSkpO1xuICB2YXIgbmFtZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhuYW1lc0RpY3QpLnNvcnQoKTtcblxuICB2YXIgbWF0cml4ID0gY29tcHV0ZU1hdGNoZXNNYXRyaXgobWF0Y2hlcywgbmFtZXMpO1xuICByZWZyZXNoTWF0Y2hlcyhuYW1lcywgbWF0cml4KTtcbn1cblxuZnVuY3Rpb24gcmVmcmVzaE1hdGNoZXMobmFtZXMsIG1hdHJpeCkge1xuICB2YXIgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblxuICB2YXIgcXVhbnRpemUgPSBkMy5zY2FsZS5xdWFudGl6ZSgpXG4gICAgLmRvbWFpbihbZDMubWluKG1hdHJpeCwgciA9PiBkMy5taW4ocikpLFxuICAgICAgICAgICAgIGQzLm1heChtYXRyaXgsIHIgPT4gZDMubWF4KHIpKV0pXG4gICAgLnJhbmdlKGQzLnJhbmdlKDUpLm1hcChpID0+IFwicVwiICsgaSkpO1xuXG4gIHZhciBjaGFydCA9IGQzLnNlbGVjdCgnI2FsbC1tYXRjaGVzJyk7XG5cbiAgY2hhcnQuYXBwZW5kKCd0aGVhZCcpXG4gICAgLmFwcGVuZCgndHInKVxuICAgIC5zZWxlY3RBbGwoJ3RkJylcbiAgICAgIC5kYXRhKG5hbWVzKVxuICAgIC5lbnRlcigpLmFwcGVuZCgndGQnKVxuICAgIC50ZXh0KGQgPT4gZCk7XG5cbiAgY2hhcnQuc2VsZWN0KCd0aGVhZCB0cicpXG4gICAgLmluc2VydCgndGQnLCAnOmZpcnN0LWNoaWxkJyk7XG5cbiAgY2hhcnQuYXBwZW5kKCd0Ym9keScpXG4gICAgLnNlbGVjdEFsbCgndHInKVxuICAgIC5kYXRhKG1hdHJpeClcbiAgICAuZW50ZXIoKS5hcHBlbmQoJ3RyJylcbiAgICAuZWFjaChtYWtlUm93KTtcblxuICBmdW5jdGlvbiBtYWtlUm93KHJvdywgeSkge1xuICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgLnNlbGVjdEFsbCgndGQnKVxuICAgICAgICAuZGF0YShyb3cpXG4gICAgICAuZW50ZXIoKS5hcHBlbmQoJ3RkJylcbiAgICAgICAgLmF0dHIoJ2RhdGEteCcsIChkLHgpID0+IHgpXG4gICAgICAgIC5hdHRyKCdkYXRhLXknLCBfID0+IHkpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsIGQgPT4gJ3NxdWFyZSAnICsgcXVhbnRpemUoZCkpXG4gICAgICAgIC5vbignbW91c2VlbnRlcicsIGhpZ2hsaWdodExhYmVscylcbiAgICAgICAgLmFwcGVuZCgnc3BhbicpXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2RlbHRhLXNjb3JlJylcbiAgICAgICAgICAudGV4dChkID0+IGQpO1xuXG4gICAgZDMuc2VsZWN0KHRoaXMpXG4gICAgICAuaW5zZXJ0KCd0ZCcsICc6Zmlyc3QtY2hpbGQnKVxuICAgICAgLmF0dHIoJ2NsYXNzJywgJ25hbWUnKVxuICAgICAgLnRleHQobmFtZXNbeV0pO1xuICB9XG5cbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2FsbC1tYXRjaGVzIHRib2R5JylcbiAgICAuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIHVuaGlnaGxpZ2h0TGFiZWxzKTtcblxuICBmdW5jdGlvbiBoaWdobGlnaHRMYWJlbHMoKSB7XG4gICAgdmFyIHRhcmdldCA9IHRoaXM7XG4gICAgY2hhcnQuc2VsZWN0QWxsKCcuc3F1YXJlJylcbiAgICAgIC5jbGFzc2VkKCdpbmFjdGl2ZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gISgodGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpID09PSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXknKVxuICAgICAgICAgICAgICAgICAgJiYgdGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpID09PSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKSlcbiAgICAgICAgICAgICAgICAgfHwgKHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKSA9PT0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS15JylcbiAgICAgICAgICAgICAgICAgICAgICYmIHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLXknKSA9PT0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS14JykpKVxuICAgICAgfSk7XG5cbiAgICB2YXIgeCA9IHBhcnNlSW50KHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKSwgMTApO1xuICAgIGNoYXJ0LnNlbGVjdEFsbCgndGhlYWQgdGQnKS5jbGFzc2VkKCdhY3RpdmUnLCAoZCwgaSkgPT4geCA9PSBpIC0gMSk7XG4gICAgdmFyIHkgPSBwYXJzZUludCh0aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS15JyksIDEwKTtcbiAgICBjaGFydC5zZWxlY3RBbGwoJy5uYW1lJykuY2xhc3NlZCgnYWN0aXZlJywgKGQsIGkpID0+IHkgPT0gaSk7XG4gIH1cblxuICBmdW5jdGlvbiB1bmhpZ2hsaWdodExhYmVscygpIHtcbiAgICBjaGFydC5zZWxlY3RBbGwoJy5pbmFjdGl2ZScpLmNsYXNzZWQoJ2luYWN0aXZlJywgZmFsc2UpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNvbXB1dGVNYXRjaGVzTWF0cml4KG1hdGNoZXMsIG5hbWVzKSB7XG4gIHZhciBtYXRyaXggPSBbXTtcblxuICAvLyBGaWxsIG1hdHJpeCB3aXRoIHplcm9lc1xuICB2YXIgbCA9IG5hbWVzLmxlbmd0aDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsOyArK2kpIHtcbiAgICBtYXRyaXhbaV0gPSBbXTtcbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IGw7ICsraikge1xuICAgICAgbWF0cml4W2ldW2pdID0gaSA9PT0gaiA/ICcnIDogMDtcbiAgICB9XG4gIH1cblxuICAvLyBDb3VudCB2aWN0b3JpZXNcbiAgbWF0Y2hlcy5mb3JFYWNoKG0gPT4ge1xuICAgIHZhciBwMSA9IG5hbWVzLmluZGV4T2YobS5wMS5uYW1lKTtcbiAgICB2YXIgcDIgPSBuYW1lcy5pbmRleE9mKG0ucDIubmFtZSk7XG5cbiAgICBpZiAobS53aW5uZXIgPT09ICdwMScpIHtcbiAgICAgIG1hdHJpeFtwMV1bcDJdICs9IDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hdHJpeFtwMl1bcDFdICs9IDE7XG4gICAgfVxuICB9KTtcblxuICAvLyBOb3JtYWxpemUgdmljdG9yaWVzXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgKytpKSB7XG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBpOyArK2opIHtcbiAgICAgIHZhciB0b3RhbE1hdGNoZXMgPSBtYXRyaXhbaV1bal0gKyBtYXRyaXhbal1baV07XG4gICAgICBpZiAodG90YWxNYXRjaGVzID4gMTApIHtcbiAgICAgICAgbWF0cml4W2ldW2pdICo9IDEwIC8gdG90YWxNYXRjaGVzO1xuICAgICAgICBtYXRyaXhbal1baV0gKj0gMTAgLyB0b3RhbE1hdGNoZXM7XG4gICAgICAgIG1hdHJpeFtpXVtqXSA9IE1hdGgucm91bmQobWF0cml4W2ldW2pdICogMTApIC8gMTA7XG4gICAgICAgIG1hdHJpeFtqXVtpXSA9IE1hdGgucm91bmQobWF0cml4W2pdW2ldICogMTApIC8gMTA7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG1hdHJpeDtcbn1cbiJdfQ==