{"version":3,"sources":["budokai.es6"],"names":[],"mappings":"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","file":"budokai.js","sourcesContent":["// Tournament helper\n// 1. Ask for number of participants\n// 2. Show the form of the tournament with numbers\n// 3. Can assign names to numbers\n// 4. Can shuffle participants\n// 5. Gives list of matches to play\n// 6. Can change winner of match at will\n\n// TODO: static views for posterity\n// TODO: different options (in number of matches) where it makes sense\n// TODO: losers bracket as an option\n\nfunction events(players, eventType) {\n  var n = players.length;\n\n  if (eventType === 'league')\n    return [leagueFair(players)];\n\n  if (n === 3) {\n    return [shuffle(league(players))];\n  }\n\n  else if (n === 4 || n === 8)\n    return [tourney(players)];\n\n  else if (n === 5) {\n    var [g1, g2] = split(players, [3,2]);\n    var l = shuffle(league(g1));\n    var w = best(2, l);\n    return [l, tourney(mix([w, g2]))];\n  }\n\n  else if (n === 6) {\n    var [g1, g2] = split(players, [3,3]);\n    var l1 = shuffle(league(g1));\n    var l2 = shuffle(league(g2));\n    var w1 = best(2, l1);\n    var w2 = best(2, l2);\n    return [l1, l2, tourney(mix([w1, w2]))];\n  }\n\n  else if (n === 7) {\n    return [tourney(players.concat(last(players)))];\n  }\n\n  else if (n === 9) {\n    var [g1, g2] = split(players, [3,6]);\n    var l = shuffle(league(g1));\n    var w = best(2, l);\n    return [l, tourney(mix([w, g2]))];\n  }\n\n  else if (n === 10) {\n    var [g1, g2] = split(players, [4,6]);\n    var l = leagueFair(g1);\n    var w = best(2, l);\n    return [l, tourney(mix([w, g2]))];\n  }\n\n  else\n    return [tourney(players)];\n}\n\nvar match = {\n  new: function(p1, p2) {\n    var m = {\n      __proto__: this,\n      p1, p2,\n    };\n\n    // Match is a bye\n    if (p1 === p2)\n      m.winner = p1;\n\n    return m;\n  },\n\n  get winner() { return () => this.win },\n  set winner(p) {\n    if (p === 'p1') this.win = this.p1;\n    else if (p === 'p2') this.win = this.p2;\n    else if (p === this.p1 || p === this.p2 || p == null)\n      this.win = p;\n    else throw \"Winner should be p1, p2 or null\";\n  },\n\n  get loser() { return () => {\n    if(this.win == null) return undefined;\n    else return this.win === this.p1 ? this.p2 : this.p1;\n  }},\n};\n\n// Return the name of a player\nfunction name(player) {\n  if (player == null) return player;\n  if (typeof player === 'function') return name(player());\n  if (typeof player === 'object') return name(player.name);\n  return player;\n}\n\nfunction last_char(player) {\n  if (player == null) return player;\n  if (typeof player === 'function') return last_char(player());\n  if (typeof player === 'object') return last_char(player.last_char);\n  return player;\n}\n\nfunction set_last_char(player, last_char) {\n  if (player == null) return;\n  if (typeof player === 'function') return set_last_char(player(), last_char);\n  if (typeof player === 'object') {\n    save(name(player), last_char);\n    player.last_char = last_char;\n  }\n}\n\n\n// Return the list of winners from a list of matches.\nfunction winners(matches) {\n  return matches.map(m => m.winner);\n}\n\nfunction losers(matches) {\n  return matches.map(m => m.loser);\n}\n\n// Return the list of the n best players, depending on a scoring\n// function for each match.  The scoring function takes a player and\n// match, and returns the player's score as a number.\nfunction best(n, matches, scoring) {\n  return range(0, n-1).map(i => bestNth(i));\n\n  // XXX: sorting and computing the scores each time is far from\n  // optimal, but we are dealing with very small numbers here.\n  function bestNth(n) {\n    return function() {\n      // Convert to array for sorting\n      var scores_array = [];\n      scores(matches, scoring)\n        .forEach(([k,v]) => { scores_array.push([k,v]) });\n      scores_array.sort(([k1,v1], [k2,v2]) => v2 - v1);\n\n      var best = scores_array[n];\n      if (best[1] === 0) return undefined;\n      else return best[0];\n    }\n  }\n}\n\n// Return a Map of (sorted) scores for the given matches and a scoring\n// function.  The scoring function takes a player and match, and\n// returns the player's score as a number.\nfunction scores(matches, scoring) {\n  if (scoring == null) scoring = defaultScoring;\n\n  var scores = new Map();       // Map supports function keys\n\n  matches.forEach(m => {\n    [m.p1, m.p2].forEach(p => {\n      var s = scores.get(p) || 0;\n      scores.set(p, s + scoring(p, m));\n    });\n  });\n\n  var sorted_scores = [...scores];\n  sorted_scores.sort(([k1,v1],[k2,v2]) => v2 - v1);\n\n  return sorted_scores;\n}\n\nfunction defaultScoring(player, match) {\n  if (player === match.winner()) return 1;\n  else return 0;\n}\n\n// Return the list of matches between players, where each player gets\n// to meet all the other players once.\nfunction league(players) {\n  if (players.length === 2)\n    return [match.new(players[0], players[1])];\n\n  var p1 = players[0];\n  var rest = players.slice(1);\n\n  var matches = rest.map(p2 => match.new(p1, p2));\n  return matches.concat(league(rest));\n}\n\nfunction isLeague(event) {\n  // If it contains matches at first level, it's a league\n  return !!event[0].p1;\n}\n\n// Return the list of matches of a league between the players, with a fair\n// distribution of matches (round-robin).  Below 5 players, it's impossible to\n// avoid playing two matches in a row.  Above, this seems to work.\nfunction leagueFair(players) {\n  var n = players.length;\n  var m = n * (n - 1) / 2;               // number of matches\n  var matchups = initArray(n, () => []); // Whether two players already met, and\n                                         // which played home.\n  var haveMet = (p1, p2) => matchups[p1][p2] != null;\n  var numMatches = p => matchups[p].filter(m => m != null).length\n  var homeMatches = p => matchups[p].filter(m => m === 1).length\n  var bins = initArray(n, () => []);     // Sort players by number of matches\n                                         // played\n  var matches = [];                      // The list of matches to return\n\n  bins[0] = range(0, n-1);\n\n  var p1, p2;\n  while (m > 0) {\n    p1 = first();\n    p2 = first(p => !haveMet(p1, p))\n    // Give a chance for the other player to play home.\n    // XXX: this does *not* ensure a fair distribution of home/away matches for\n    // each player.  Does not work for N=5 at least, where a fair distribution\n    // exists.\n    if (homeMatches(p1) > homeMatches(p2))\n      [p1, p2] = [p2, p1]\n    matches.push(match.new(players[p1], players[p2]));\n    matchups[p1][p2] =  1;\n    matchups[p2][p1] = -1;\n    bins[numMatches(p1)].push(p1);\n    bins[numMatches(p2)].push(p2);\n    --m;\n  }\n\n  return matches;\n\n  // Remove and return the first element in bins that matches the predicate,\n  // going through the bins in increasing order of number of matches played.\n  function first(pred) {\n    pred = pred || (() => true);\n    for (var bi = 0; bi < bins.length; ++bi) {\n      var b = bins[bi];\n      for (var i = 0; i < b.length; ++i) {\n        if (pred(b[i])) {\n          return b.splice(i, 1)[0];\n        }\n      }\n    }\n    return undefined;\n  }\n}\n\nfunction initArray(length, initFunction) {\n  var a = new Array(length);\n  while (length-- > 0) a[length] = initFunction(length);\n  return a;\n}\n\n// Return a list of levels, where each level is a list of matches\n// between players in the tourney.  Finale is the last level.\nfunction tourney(players) {\n  if (players.length === 2)\n    return [[match.new(players[0], players[1])]];\n\n  var n = Math.pow(2, Math.floor(Math.log(players.length)/Math.LN2));\n  var m = players.length - n;\n  if (m > 0) {\n    var [now, up] = split(players, [m * 2]);\n    var elim = pairs(now);\n    var byes = up.map(p => match.new(p,p));\n    var matches = elim.concat(byes);\n    return [matches].concat(tourney(winners(matches)));\n  } else {\n    var matches = pairs(players);\n    return [matches].concat(tourney(winners(matches)));\n  }\n}\n\nfunction losersBracket(tourney, prevWinners) {\n  if (prevWinners == null) prevWinners = [];\n  if (tourney.length === 0) return [];\n  console.log(prevWinners.concat(losers(tourney[0])).length);\n\n  var matches = pairs(prevWinners.concat(losers(tourney[0])));\n  return [matches].concat(losersBracket(tourney.slice(1),\n                                        winners(matches)));\n}\n\nfunction tourneyDoubleElimination(players) {\n  var t = tourney(players);\n  var l = losersBracket(t);\n  var finale = pairs(winners(last(t).concat(last(l))));\n  return [t, l, finale];\n}\n\n// Return a list of matches between players, where each player is\n// matched with its neighbor, as in the first level of a tourney.\nfunction pairs(players) {\n  if (players.length % 2 === 1)\n    throw \"Can't pair odd number of players\";\n\n  var matches = [];\n  for (var i = 0; i < players.length; i += 2) {\n    var m = match.new(players[i], players[i+1]);\n    matches.push(m);\n  }\n  return matches;\n}\n\n// Return the list of players split into groups of lengths specified\n// by `groups`.\nfunction split(players, groups) {\n  if (groups.length === 0)\n    return [players];\n\n  var hd = players.slice(0, groups[0]);\n  var tl = players.slice(groups[0]);\n  var g = groups.slice(1);\n  return [hd].concat(split(tl, g));\n}\n\n// range(start, end) return [start, ..., end].\n// range(end) return [1, ..., end].\nfunction range(start, end) {\n  if (end == null) {\n    end = start;\n    start = 1;\n  }\n  if (end < start) return [];\n  else return range(start, end - 1).concat(end);\n}\n\n// Mix players out of elimination rounds as to not meet again in the\n// first level of a tourney.  [[1,2],[3,4],...] yields [1,3,2,4,...].\nfunction mix(groups) {\n  if (groups[0].length === 0) return groups[1];\n  if (groups[1].length === 0) return groups[0];\n\n  var heads = groups.map(g => g[0]);\n  var tails = groups.map(g => g.slice(1));\n\n  return heads.concat(mix(tails));\n}\n\nfunction last(matches) {\n  return matches[matches.length - 1];\n}\n\nfunction shuffle(array) {\n  var r = () => Math.floor(Math.random() * array.length);\n\n  var shuffled = [];\n  for (var i = 0; i < array.length; i++) {\n    var j = r();\n    while (shuffled[j])\n      j = (j + 1) % array.length;\n    shuffled[j] = array[i];\n  }\n\n  return shuffled;\n}\n\n//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n// View\n\nvar render = {\n  events: function(es) {\n    var $f = document.createDocumentFragment();\n    es.forEach(e => { $f.appendChild(render.event(e)); });\n    return $f;\n  },\n\n  event: function(e) {\n    if (isLeague(e)) return render.league(e);\n    else return render.tourney(e);\n  },\n\n  league: function(l) {\n    var $f = document.createElement('div');\n    $f.classList.add('league');\n\n    var $header = document.createElement('h3');\n    $header.textContent = 'League';\n    $f.appendChild($header);\n\n    var $div = document.createElement('div');\n    $div.classList.add('league-content');\n\n    var $matches = document.createElement('ol');\n    $matches.classList.add('league-matches');\n    l.forEach(m => { $matches.appendChild(render.match(m)); });\n    $div.appendChild($matches);\n\n    var $scores = document.createElement('table');\n    $scores.classList.add('league-scores');\n    var $scores_head = document.createElement('tr');\n\n    var $th_player = document.createElement('th');\n    $th_player.textContent = 'Player';\n    $scores_head.appendChild($th_player);\n\n    var $th_score = document.createElement('th');\n    $th_score.textContent = 'Score';\n    $scores_head.appendChild($th_score);\n\n    $scores.appendChild($scores_head);\n\n    scores(l).forEach(([k,v]) => {\n      var $s = document.createElement('tr');\n\n      var $name = document.createElement('td');\n      $name.textContent = name(k);\n      $s.appendChild($name);\n\n      var $points = document.createElement('td');\n      $points.textContent = v;\n      $s.appendChild($points);\n\n      $scores.appendChild($s);\n    });\n\n    $div.appendChild($scores);\n\n    $f.appendChild($div);\n\n    return $f;\n  },\n\n  tourney: function(t) {\n    var $f = document.createElement('div');\n    $f.classList.add('tourney');\n\n    var $header = document.createElement('h3');\n    $header.textContent = 'Tourney';\n    $f.appendChild($header);\n\n    var $t = document.createElement('div');\n    $t.classList.add('tourney-matches');\n    t.forEach(l => { $t.appendChild(render.level(l)); });\n    $f.appendChild($t);\n\n    var $winnerLevel = document.createElement('ol');\n    $winnerLevel.classList.add('level');\n\n    var $winner = document.createElement('span');\n    $winner.classList.add('player-name');\n    $winner.classList.add('winner');\n    $winner.textContent = name(last(t)[0].winner);\n    $winnerLevel.appendChild($winner);\n\n    $t.appendChild($winnerLevel);\n\n    return $f;\n  },\n\n  level: function(l) {\n    var $f = document.createDocumentFragment();\n    $f.appendChild(render.matches(l));\n    return $f;\n  },\n\n  matches: function(ms) {\n    var $f = document.createElement('ol');\n    $f.classList.add('level');\n    ms.forEach(m => { $f.appendChild(render.match(m)); });\n    return $f;\n  },\n\n  match: function(m) {\n    var $f = document.createElement('li');\n    $f.classList.add('match');\n    if (m.p1 === m.p2)\n      $f.classList.add('bye');\n\n    var $player1 = document.createElement('div');\n    $player1.classList.add('player1');\n    $f.appendChild($player1);\n\n    var $p1 = render.player(m.p1, m);\n    $player1.appendChild($p1);\n\n    var $char_p1 = render.chars_list(m.p1, m.p1_char);\n    $char_p1.addEventListener('change', (event) => {\n      m.p1_char = event.target.value;\n      set_last_char(m.p1, m.p1_char);\n    });\n    $p1.appendChild($char_p1);\n    $p1.addEventListener('click', saveChars);\n\n    var $player2 = document.createElement('div');\n    $player2.classList.add('player2');\n    $f.appendChild($player2);\n\n    var $p2 = render.player(m.p2, m);\n    $player2.appendChild($p2);\n\n    var $char_p2 = render.chars_list(m.p2, m.p2_char);\n    $char_p2.addEventListener('change', (event) => {\n      m.p2_char = event.target.value;\n      set_last_char(m.p2, m.p2_char);\n    });\n    $p2.appendChild($char_p2);\n    $p2.addEventListener('click', saveChars);\n\n    var $reset = document.createElement('button');\n    $reset.classList.add('reset-match');\n    $reset.textContent = 'X';\n    $reset.addEventListener('click', () => {\n      m.winner = null;\n      m.p1_char = null;\n      m.p2_char = null;\n    });\n    $f.appendChild($reset);\n\n    return $f;\n\n    function saveChars() {\n      m.p1_char = $char_p1.value;\n      m.p2_char = $char_p2.value;\n    }\n  },\n\n  chars_list: function(p, p_char) {\n    var $p = document.createElement('input');\n    $p.classList.add('char');\n    $p.type = 'text';\n    $p.placeholder = 'Dan';\n    $p.setAttribute('list', 'all-chars');\n    var ch = p_char || last_char(p) || retrieve(name(p));\n    if (ch != null)\n      $p.value = ch;\n\n    return $p;\n  },\n\n  player: function(p, m) {\n    var $f = document.createElement('div');\n    $f.classList.add('player-info');\n\n    var $button = document.createElement('input');\n    $button.id = `radio-${genid()}`;\n    $button.setAttribute('type', 'radio');\n\n    $button.addEventListener('click', () => { m.winner = p; });\n    if (p === m.winner())\n      $button.setAttribute('checked', true);\n    if (name(m.p1) == null || name(m.p2) == null)\n      $button.setAttribute('disabled', true);\n    $f.appendChild($button);\n\n    var $label = document.createElement('label');\n    $label.classList.add('player-name');\n    $label.textContent = name(p);\n    $label.setAttribute('for', $button.id);\n    $f.appendChild($label);\n\n    return $f;\n  },\n\n  saveLink: function(events) {\n    var $div = document.createElement('div');\n    $div.classList.add('budokai-data');\n\n    var link = encode(serialize.all(events));\n\n    var $p = document.createElement('p');\n    $p.classList.add('data');\n    $p.textContent = link;\n    $div.appendChild($p);\n\n    var $a = document.createElement('a');\n    $a.setAttribute('href',\n                    encodeURI(`mailto:?subject=[Budokai] Save me&body=${link}`));\n    $a.textContent = 'post';\n    $div.appendChild($a);\n\n    return $div;\n  },\n};\n\nvar view = {\n  new: function($root, events) {\n    return {\n      __proto__: this,\n      $root, events,\n    };\n  },\n\n  refresh: function() {\n    this.$root.innerHTML = '';\n    this.$root.appendChild(render.events(this.events));\n    this.$root.appendChild(render.saveLink(this.events));\n  },\n};\n\nvar serialize = {\n  all(events) {\n    var ev = [];\n\n    events.forEach(e => {\n      if (isLeague(e)) ev.push(serialize.league(e))\n      else ev.push(serialize.tourney(e))\n    });\n\n    var m = {\n      version: 1,\n      date: (new Date()).toISOString().split('T')[0]\n      ,events: ev\n    };\n\n    return JSON.stringify(m);\n  },\n\n  league(l) {\n    return l.map(m => serialize.match(m));\n  },\n\n  tourney(t) {\n    var matches = [];\n    t.forEach(bracket => bracket.forEach(m => {\n      if (m.p1 !== m.p2)\n      matches.push(serialize.match(m));\n    }));\n    return matches;\n  },\n\n  match(m) {\n    var winner;\n    if (m.p1 === m.winner())\n      winner = 'p1';\n    else if (m.winner() === m.p2)\n      winner = 'p2';\n\n    return {\n      p1: {name: name(m.p1),\n           char: m.p1_char},\n      p2: {name: name(m.p2),\n           char: m.p2_char},\n      winner,\n    };\n  },\n};\n\nvar encode = s => btoa(encodeURI(s))\nvar decode = s => decodeURI(atob(s))\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  var $players = document.querySelector('#player-list');\n  var $list = document.querySelector('#match-list');\n  var $n = document.querySelector('#n-players');\n  var $isTourney = document.querySelector('#event-type-tourney');\n  var $isLeague = document.querySelector('#event-type-league');\n\n  var v = view.new($list);\n\n  $n.addEventListener('input', refreshEvents);\n  $isTourney.addEventListener('change', refreshEvents);\n  $isLeague.addEventListener('change', refreshEvents);\n\n  function refreshEvents() {\n    var n = parseInt($n.value, 10);\n    var eventType = $isTourney.checked ? 'tourney' : 'league';\n    var players = [];\n\n    range(n).forEach(i => {\n      if ($players.childNodes[i] == null) {\n        var $div = document.createElement('div');\n        $div.id = `player-${i}`;\n        $div.classList.add('name-container');\n\n        var $name = document.createElement('input');\n        $name.classList.add('name');\n        $name.setAttribute('type', 'text');\n        $name.value = retrieve($div.id) || 'P' + i;\n        $div.appendChild($name);\n\n        var $lock = document.createElement('input');\n        $lock.id = `lock-${i}`;\n        $lock.classList.add('lock');\n        $lock.setAttribute('type', 'checkbox');\n        $lock.addEventListener('click', () => {\n          $name.classList.toggle('locked');\n          $name.disabled = !$name.disabled;\n        });\n        $div.appendChild($lock);\n\n        var $label = document.createElement('label');\n        $label.setAttribute('for', $lock.id);\n        $label.innerHTML =\n          '<i class=\"fa fa-unlock\"></i><i class=\"fa fa-lock\"></i>';\n        $div.appendChild($label);\n\n        $players.appendChild($div);\n      } else {\n        $players.childNodes[i].classList.remove('off');\n        var $name = $players.querySelector(`#player-${i} .name`);\n      }\n      players.push({name: () => $name.value});\n    });\n\n    range(n+1, $players.childNodes.length-1).forEach(i => {\n      $players.childNodes[i].classList.add('off');\n    });\n\n    v.events = events(players, eventType);\n    v.refresh();\n  }\n\n  $n.dispatchEvent(new Event('input'));\n\n  $players.addEventListener('input', (event) => {\n    if (event.target.classList.contains('name')) {\n      save(event.target.parentNode.id, event.target.value);\n      v.refresh();\n    }\n  });\n\n  $list.addEventListener('change', event => {\n    // Need the setTimeout to let the event bubble and be caught by\n    // other listeners before recreating the view\n    setTimeout(() => { v.refresh(); } , 0);\n  });\n\n  var $shuffle = document.querySelector('#shuffle-players');\n  $shuffle.addEventListener('click', () => {\n    var $names = [].filter.call(\n      $players.querySelectorAll('input.name'),\n      $p => !$p.parentNode.classList.contains('off')\n         && !$p.classList.contains('locked'));\n    var names = [].map.call($names, $i => $i.value);\n    names = shuffle(names);\n    [].forEach.call($names, ($n,i) => { $n.value = names[i]; });\n    v.refresh();\n  });\n});\n\nvar save = (k,v) => localStorage.setItem(k,v);\nvar retrieve = k => localStorage.getItem(k);\nvar genid = (() => { var i = 0; return () => ++i })();\n"]}