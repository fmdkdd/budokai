{"version":3,"sources":["budokai.es6"],"names":[],"mappings":"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","file":"budokai.js","sourcesContent":["// Tournament helper\n// 1. Ask for number of participants\n// 2. Show the form of the tournament with numbers\n// 3. Can assign names to numbers\n// 4. Can shuffle participants\n// 5. Gives list of matches to play\n// 6. Can change winner of match at will\n\n// TODO: static views for posterity\n// TODO: different options (in number of matches) where it makes sense\n// TODO: losers bracket as an option\n\n\n//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n// Utils\n\nlet save = (k,v) => localStorage.setItem(k,v)\nlet retrieve = k => localStorage.getItem(k)\nlet genid = (() => { let i = 0; return () => ++i })()\n\nlet encode = s => btoa(encodeURI(s))\nlet decode = s => decodeURI(atob(s))\n\nfunction fromTemplate(selector) {\n  let $template = document.querySelector(selector)\n  let $fragment = document.importNode($template.content, true)\n  return $fragment\n}\n\nfunction debounce(func, wait = 0) {\n  let timeout\n  return function(...args) {\n    if (timeout)\n      clearTimeout(timeout)\n    timeout = setTimeout(() => func.apply(this, args), wait)\n  }\n}\n\nlet m2f = Function.prototype.bind.bind(Function.prototype.call)\nlet forEach = m2f(Array.prototype.forEach)\nlet map = m2f(Array.prototype.map)\nlet filter = m2f(Array.prototype.filter)\n\nfunction initArray(length, initFunction) {\n  var a = new Array(length);\n  while (length-- > 0) a[length] = initFunction(length);\n  return a;\n}\n\n// range(start, end) return [start, ..., end].\n// range(end) return [1, ..., end].\nfunction range(start, end) {\n  if (end == null) {\n    end = start;\n    start = 1;\n  }\n  if (end < start) return [];\n  else return range(start, end - 1).concat(end);\n}\n\nfunction shuffle(array) {\n  var r = () => Math.floor(Math.random() * array.length);\n\n  var shuffled = [];\n  for (var i = 0; i < array.length; i++) {\n    var j = r();\n    while (shuffled[j])\n      j = (j + 1) % array.length;\n    shuffled[j] = array[i];\n  }\n\n  return shuffled;\n}\n\n\n//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nfunction events(players, eventType) {\n  var n = players.length;\n\n  if (eventType === 'league')\n    return [leagueFair(players)];\n\n  if (n === 3) {\n    return [shuffle(league(players))];\n  }\n\n  else if (n === 4 || n === 8)\n    return [tourney(players)];\n\n  else if (n === 5) {\n    var [g1, g2] = split(players, [3,2]);\n    var l = shuffle(league(g1));\n    var w = best(2, l);\n    return [l, tourney(mix([w, g2]))];\n  }\n\n  else if (n === 6) {\n    var [g1, g2] = split(players, [3,3]);\n    var l1 = shuffle(league(g1));\n    var l2 = shuffle(league(g2));\n    var w1 = best(2, l1);\n    var w2 = best(2, l2);\n    return [l1, l2, tourney(mix([w1, w2]))];\n  }\n\n  else if (n === 7) {\n    return [tourney(players.concat(last(players)))];\n  }\n\n  else if (n === 9) {\n    var [g1, g2] = split(players, [3,6]);\n    var l = shuffle(league(g1));\n    var w = best(2, l);\n    return [l, tourney(mix([w, g2]))];\n  }\n\n  else if (n === 10) {\n    var [g1, g2] = split(players, [4,6]);\n    var l = leagueFair(g1);\n    var w = best(2, l);\n    return [l, tourney(mix([w, g2]))];\n  }\n\n  else\n    return [tourney(players)];\n}\n\nvar match = {\n  new: function(p1, p2) {\n    var m = {\n      __proto__: this,\n      p1, p2,\n    };\n\n    // Match is a bye\n    if (p1 === p2)\n      m.winner = p1;\n\n    return m;\n  },\n\n  get winner() { return () => this.win },\n  set winner(p) {\n    if (p === 'p1') this.win = this.p1;\n    else if (p === 'p2') this.win = this.p2;\n    else if (p === this.p1 || p === this.p2 || p == null)\n      this.win = p;\n    else throw \"Winner should be p1, p2 or null\";\n  },\n\n  get loser() { return () => {\n    if(this.win == null) return undefined;\n    else return this.win === this.p1 ? this.p2 : this.p1;\n  }},\n};\n\n// Return the name of a player\nfunction name(player) {\n  if (player == null) return player;\n  if (typeof player === 'function') return name(player());\n  if (typeof player === 'object') return name(player.name);\n  return player;\n}\n\n// Return the list of winners from a list of matches.\nfunction winners(matches) {\n  return matches.map(m => m.winner);\n}\n\nfunction losers(matches) {\n  return matches.map(m => m.loser);\n}\n\n// Return the list of the n best players, depending on a scoring\n// function for each match.  The scoring function takes a player and\n// match, and returns the player's score as a number.\nfunction best(n, matches, scoring) {\n  return range(0, n-1).map(i => bestNth(i));\n\n  // XXX: sorting and computing the scores each time is far from\n  // optimal, but we are dealing with very small numbers here.\n  function bestNth(n) {\n    return function() {\n      // Convert to array for sorting\n      var scores_array = [];\n      scores(matches, scoring)\n        .forEach(([k,v]) => { scores_array.push([k,v]) });\n      scores_array.sort(([k1,v1], [k2,v2]) => v2 - v1);\n\n      var best = scores_array[n];\n      if (best[1] === 0) return undefined;\n      else return best[0];\n    }\n  }\n}\n\n// Return a Map of (sorted) scores for the given matches and a scoring\n// function.  The scoring function takes a player and match, and\n// returns the player's score as a number.\nfunction scores(matches, scoring) {\n  if (scoring == null) scoring = defaultScoring;\n\n  var scores = new Map();       // Map supports function keys\n\n  matches.forEach(m => {\n    [m.p1, m.p2].forEach(p => {\n      var s = scores.get(p) || 0;\n      scores.set(p, s + scoring(p, m));\n    });\n  });\n\n  var sorted_scores = [...scores];\n  sorted_scores.sort(([k1,v1],[k2,v2]) => v2 - v1);\n\n  return sorted_scores;\n}\n\nfunction defaultScoring(player, match) {\n  if (player === match.winner()) return 1;\n  else return 0;\n}\n\n// Return the list of matches between players, where each player gets\n// to meet all the other players once.\nfunction league(players) {\n  if (players.length === 2)\n    return [match.new(players[0], players[1])];\n\n  var p1 = players[0];\n  var rest = players.slice(1);\n\n  var matches = rest.map(p2 => match.new(p1, p2));\n  return matches.concat(league(rest));\n}\n\nfunction isLeague(event) {\n  // If it contains matches at first level, it's a league\n  return !!event[0].p1;\n}\n\n// Return the list of matches of a league between the players, with a fair\n// distribution of matches (round-robin).  Below 5 players, it's impossible to\n// avoid playing two matches in a row.  Above, this seems to work.\nfunction leagueFair(players) {\n  var n = players.length;\n  var m = n * (n - 1) / 2;               // number of matches\n  var matchups = initArray(n, () => []); // Whether two players already met, and\n                                         // which played home.\n  var haveMet = (p1, p2) => matchups[p1][p2] != null;\n  var numMatches = p => matchups[p].filter(m => m != null).length\n  var homeMatches = p => matchups[p].filter(m => m === 1).length\n  var bins = initArray(n, () => []);     // Sort players by number of matches\n                                         // played\n  var matches = [];                      // The list of matches to return\n\n  bins[0] = range(0, n-1);\n\n  var p1, p2;\n  while (m > 0) {\n    p1 = first();\n    p2 = first(p => !haveMet(p1, p))\n    // Give a chance for the other player to play home.\n    // XXX: this does *not* ensure a fair distribution of home/away matches for\n    // each player.  Does not work for N=5 at least, where a fair distribution\n    // exists.\n    if (homeMatches(p1) > homeMatches(p2))\n      [p1, p2] = [p2, p1]\n    matches.push(match.new(players[p1], players[p2]));\n    matchups[p1][p2] =  1;\n    matchups[p2][p1] = -1;\n    bins[numMatches(p1)].push(p1);\n    bins[numMatches(p2)].push(p2);\n    --m;\n  }\n\n  return matches;\n\n  // Remove and return the first element in bins that matches the predicate,\n  // going through the bins in increasing order of number of matches played.\n  function first(pred) {\n    pred = pred || (() => true);\n    for (var bi = 0; bi < bins.length; ++bi) {\n      var b = bins[bi];\n      for (var i = 0; i < b.length; ++i) {\n        if (pred(b[i])) {\n          return b.splice(i, 1)[0];\n        }\n      }\n    }\n    return undefined;\n  }\n}\n\n\n// Return a list of levels, where each level is a list of matches\n// between players in the tourney.  Finale is the last level.\nfunction tourney(players) {\n  if (players.length === 2)\n    return [[match.new(players[0], players[1])]];\n\n  var n = Math.pow(2, Math.floor(Math.log(players.length)/Math.LN2));\n  var m = players.length - n;\n  if (m > 0) {\n    var [now, up] = split(players, [m * 2]);\n    var elim = pairs(now);\n    var byes = up.map(p => match.new(p,p));\n    var matches = elim.concat(byes);\n    return [matches].concat(tourney(winners(matches)));\n  } else {\n    var matches = pairs(players);\n    return [matches].concat(tourney(winners(matches)));\n  }\n}\n\nfunction losersBracket(tourney, prevWinners) {\n  if (prevWinners == null) prevWinners = [];\n  if (tourney.length === 0) return [];\n  console.log(prevWinners.concat(losers(tourney[0])).length);\n\n  var matches = pairs(prevWinners.concat(losers(tourney[0])));\n  return [matches].concat(losersBracket(tourney.slice(1),\n                                        winners(matches)));\n}\n\nfunction tourneyDoubleElimination(players) {\n  var t = tourney(players);\n  var l = losersBracket(t);\n  var finale = pairs(winners(last(t).concat(last(l))));\n  return [t, l, finale];\n}\n\n// Return a list of matches between players, where each player is\n// matched with its neighbor, as in the first level of a tourney.\nfunction pairs(players) {\n  if (players.length % 2 === 1)\n    throw \"Can't pair odd number of players\";\n\n  var matches = [];\n  for (var i = 0; i < players.length; i += 2) {\n    var m = match.new(players[i], players[i+1]);\n    matches.push(m);\n  }\n  return matches;\n}\n\n// Return the list of players split into groups of lengths specified\n// by `groups`.\nfunction split(players, groups) {\n  if (groups.length === 0)\n    return [players];\n\n  var hd = players.slice(0, groups[0]);\n  var tl = players.slice(groups[0]);\n  var g = groups.slice(1);\n  return [hd].concat(split(tl, g));\n}\n\n// Mix players out of elimination rounds as to not meet again in the\n// first level of a tourney.  [[1,2],[3,4],...] yields [1,3,2,4,...].\nfunction mix(groups) {\n  if (groups[0].length === 0) return groups[1];\n  if (groups[1].length === 0) return groups[0];\n\n  var heads = groups.map(g => g[0]);\n  var tails = groups.map(g => g.slice(1));\n\n  return heads.concat(mix(tails));\n}\n\nfunction last(matches) {\n  return matches[matches.length - 1];\n}\n\n\n//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n// View\n\nlet domToModel = new WeakMap()\n\nvar render = {\n  events(es) {\n    var $f = document.createDocumentFragment();\n    es.forEach(e => { $f.appendChild(render.event(e)); });\n    return $f;\n  },\n\n  event(e) {\n    if (isLeague(e)) return render.league(e);\n    else return render.tourney(e);\n  },\n\n  league(l) {\n    let $fragment = fromTemplate('#template-league')\n    let $l = $fragment.querySelector('.league')\n\n    let $matches = $l.querySelector('.league-matches')\n    l.forEach(m => { $matches.appendChild(render.match(m)) })\n\n    let $scores = $l.querySelector('.league-scores tbody')\n    scores(l).forEach(([k,v]) => {\n      let $fragment = fromTemplate('#template-league-scores-row')\n      let $name = $fragment.children[0].children[0]\n      let $score = $fragment.children[0].children[1]\n      $name.textContent = name(k)\n      $score.textContent = v\n\n      document.addEventListener('name-changed', event => {\n        if (event.detail.player === k)\n          $name.textContent = name(k)\n      })\n\n      $scores.appendChild($fragment)\n    })\n\n    document.addEventListener('winner-changed', event => {\n      scores(l).forEach(([k,v], i) => {\n        let $row = $scores.children[i]\n        $row.children[0].textContent = name(k)\n        $row.children[1].textContent = v\n      })\n    })\n\n    return $l\n  },\n\n  tourney(t) {\n    let $fragment = fromTemplate('#template-tourney')\n    let $t = $fragment.querySelector('.tourney')\n\n    let $matches = $t.querySelector('.tourney-matches')\n    let $winnerLevel = $matches.children[0]\n    t.forEach(l => {\n      $matches.insertBefore(render.level(l), $winnerLevel) })\n\n    let $winner = $winnerLevel.querySelector('.winner')\n    let finale = last(t)[0]\n    let winner = finale.winner\n    $winner.textContent = name(winner)\n\n    document.addEventListener('name-changed', event => {\n      if (event.detail.player === winner)\n        $winner.textContent = name(winner)\n    })\n\n    document.addEventListener('winner-changed', event => {\n      if (event.detail.match === finale)\n        $winner.textContent = name(winner)\n    })\n\n    return $t\n  },\n\n  level(l) {\n    let $fragment = fromTemplate('#template-tourney-level')\n    let $l = $fragment.children[0]\n    l.forEach(m => {\n      $l.appendChild(render.match(m)) })\n\n    return $l\n  },\n\n  match(m) {\n    let $fragment = fromTemplate('#template-match')\n    let $m = $fragment.querySelector('.match')\n\n    domToModel.set($m, m)\n\n    if (m.p1 === m.p2)\n      $m.classList.add('bye')\n\n    ;[m.p1, m.p2].forEach((p, i) => {\n      let player = i + 1\n      let $button = $m.querySelector(`#radio-${player}`)\n      $button.id = `radio-${genid()}`\n\n      domToModel.set($button.parentNode, p)\n\n      if (name(m.p1) == null || name(m.p2) == null)\n        $button.setAttribute('disabled', true)\n\n      let $label = $m.querySelector(`.player${player} label`)\n      $label.textContent = name(p)\n      $label.setAttribute('for', $button.id)\n\n      document.addEventListener('winner-changed', event => {\n        if (event.detail.match === m) {\n          let winner = event.detail.winner\n          $button.checked = winner === p\n        } else {\n          $label.textContent = name(p)\n\n          if (name(m.p1) == null || name(m.p2) == null)\n            $button.setAttribute('disabled', true)\n          else\n            $button.removeAttribute('disabled')\n        }\n      })\n\n      document.addEventListener('name-changed', event => {\n        if (event.detail.player === p)\n          $label.textContent = name(p)\n      })\n\n      let $char = $m.querySelector(`.player${player} .char`)\n      $char.value = retrieve(name(p))\n\n      document.addEventListener('char-changed', event => {\n        let charProp = `p${player}_char`\n        if (event.detail.player === p) {\n          if (event.detail.match === m)\n            m[charProp] = event.detail.char\n            else if (!m[charProp])\n              $char.value = event.detail.char\n        }\n      })\n\n      document.addEventListener('shuffle-players', event => {\n        $label.textContent = name(p)\n        $char.value = retrieve(name(p))\n      })\n    })\n\n    return $m\n  },\n\n  saveLink(events) {\n    let $div = document.querySelector('.budokai-data')\n\n    let link = encode(serialize.all(events))\n    let url = `mailto:?subject=[Budokai] Save me&body=${link}`\n\n    let $p = $div.querySelector('.data')\n    $p.textContent = link\n\n    let $a = $div.querySelector('a')\n    $a.setAttribute('href', encodeURI(url))\n  },\n\n  refreshPlayerList(n) {\n    let $players = document.querySelector('#player-list')\n\n    range(n).forEach(i => {\n      let $node = $players.childNodes[i-1]\n      if ($node == null) {\n        let $fragment = fromTemplate('#template-player-name')\n        let $div = $fragment.querySelector('.name-container')\n        $div.id = `player-${i}`\n\n        let $name = $div.querySelector('.name')\n        $name.value = retrieve($div.id) || 'P' + i\n\n        let $lock = $div.querySelector('.lock')\n        $lock.id = `lock-${i}`\n\n        let $label = $div.querySelector('label')\n        $label.setAttribute('for', $lock.id)\n\n        $players.appendChild($div)\n      } else {\n        $node.classList.remove('off')\n      }\n    })\n\n    range(n+1, $players.childNodes.length).forEach(i => {\n      let $node = $players.childNodes[i-1]\n      $node.classList.add('off')\n    })\n  },\n\n  refreshEvents(eventType) {\n    let $players = filter(document.querySelectorAll('#player-list .name'),\n                      $p => !$p.parentNode.classList.contains('off'))\n    let players = []\n    forEach($players, $p => {\n      let p = {name: () => $p.value}\n      players.push(p)\n      domToModel.set($p, p)\n    })\n\n    let evs = events(players, eventType)\n\n    let $list = document.querySelector('#match-list');\n    $list.innerHTML = ''\n    $list.appendChild(render.events(evs))\n    domToModel.set(document, evs)\n  },\n}\n\nvar serialize = {\n  all(events) {\n    var ev = [];\n\n    events.forEach(e => {\n      if (isLeague(e)) ev.push(serialize.league(e))\n      else ev.push(serialize.tourney(e))\n    });\n\n    var m = {\n      version: 1,\n      date: (new Date()).toISOString().split('T')[0]\n      ,events: ev\n    };\n\n    return JSON.stringify(m);\n  },\n\n  league(l) {\n    return l.map(m => serialize.match(m));\n  },\n\n  tourney(t) {\n    var matches = [];\n    t.forEach(bracket => bracket.forEach(m => {\n      if (m.p1 !== m.p2)\n      matches.push(serialize.match(m));\n    }));\n    return matches;\n  },\n\n  match(m) {\n    var winner;\n    if (m.p1 === m.winner())\n      winner = 'p1';\n    else if (m.winner() === m.p2)\n      winner = 'p2';\n\n    return {\n      p1: {name: name(m.p1),\n           char: m.p1_char},\n      p2: {name: name(m.p2),\n           char: m.p2_char},\n      winner,\n    };\n  },\n};\n\nfunction dispatch(eventName, detail = null) {\n  document.dispatchEvent(new CustomEvent(eventName, {detail}))\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  let $n = document.querySelector('#n-players')\n  let $nOutput = document.querySelector('#n-players-output')\n  let $isTourney = document.querySelector('#event-type-tourney')\n  let $isLeague = document.querySelector('#event-type-league')\n  let $players = document.querySelector('#player-list')\n  let $list = document.querySelector('#match-list');\n  let $shuffle = document.querySelector('#shuffle-players')\n\n  //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n  // Custom events\n\n  function playersChanged() {\n    let n = parseInt($n.value, 10)\n    dispatch('n-players-changed', n)\n  }\n\n  function eventTypeChanged() {\n    let eventType = $isTourney.checked ? 'tourney' : 'league'\n    dispatch('event-type-changed', eventType)\n  }\n\n  function nameChanged(playerId, player, name) {\n    dispatch('name-changed', {playerId, player, name})\n  }\n\n  function shufflePlayers() {\n    dispatch('shuffle-players')\n  }\n\n  function lockPlayer($name) {\n    dispatch('lock-player', $name)\n  }\n\n  function winnerChanged(match, winner, $match) {\n    dispatch('winner-changed', {match, winner, $match})\n  }\n\n  function charChanged(match, player, char) {\n    dispatch('char-changed', {match, player, char})\n  }\n\n  //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n  // DOM events -> custom events\n\n  $n.addEventListener('input', debounce(playersChanged, 30))\n  $isTourney.addEventListener('change', debounce(eventTypeChanged, 30))\n  $isLeague.addEventListener('change', debounce(eventTypeChanged, 30))\n\n  $players.addEventListener('input', debounce(event => {\n    if (event.target.classList.contains('name')) {\n      let playerId = event.target.parentNode.id\n      let player = domToModel.get(event.target)\n      let name = event.target.value\n      nameChanged(playerId, player, name)\n    }\n  }, 100))\n\n  $shuffle.addEventListener('click', debounce(shufflePlayers, 30))\n\n  $players.addEventListener('click', debounce(event => {\n    if (event.target.classList.contains('lock')) {\n      let $name = event.target.parentNode.querySelector('.name')\n      lockPlayer($name)\n    }\n  }, 30))\n\n  $list.addEventListener('change', debounce(event => {\n    if (event.target.classList.contains('winner-select')) {\n      let $player = event.target.parentNode\n      let $match = $player.parentNode.parentNode\n      let winner = domToModel.get($player)\n      let match = domToModel.get($match)\n      winnerChanged(match, winner, $match)\n    }\n  }, 30))\n\n  $list.addEventListener('input', debounce(event => {\n    if (event.target.classList.contains('char')) {\n      let $player = event.target.parentNode\n      let $match = $player.parentNode.parentNode\n      let player = domToModel.get($player)\n      let match = domToModel.get($match)\n      let char = event.target.value\n      charChanged(match, player, char)\n    }\n  }, 100))\n\n  //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n  // Handling custom events\n\n  document.addEventListener('n-players-changed', event => {\n    $nOutput.value = event.detail\n    render.refreshPlayerList(event.detail)\n    render.refreshEvents($isTourney.checked ? 'tourney' : 'league')\n\n    render.saveLink(domToModel.get(document))\n  })\n\n  document.addEventListener('event-type-changed', event => {\n    render.refreshEvents(event.detail)\n\n    render.saveLink(domToModel.get(document))\n  })\n\n  document.addEventListener('name-changed', event => {\n    save(event.detail.playerId, event.detail.name)\n\n    render.saveLink(domToModel.get(document))\n  })\n\n  document.addEventListener('shuffle-players', () => {\n    let $unlockedNames = filter(\n      $players.querySelectorAll('input.name'),\n      $p => !$p.parentNode.classList.contains('off')\n        && !$p.classList.contains('locked'))\n    let names = map($unlockedNames, $i => $i.value)\n    names = shuffle(names)\n    forEach($unlockedNames, ($n,i) => {$n.value = names[i]})\n  })\n\n  document.addEventListener('lock-player', event => {\n    let $name = event.detail\n    $name.classList.toggle('locked')\n    $name.disabled = !$name.disabled\n  })\n\n  document.addEventListener('winner-changed', event => {\n    let {match, $match, winner} = event.detail\n    match.winner = winner\n\n    match.p1_char = $match.querySelector('.player1 .char').value\n    match.p2_char = $match.querySelector('.player2 .char').value\n\n    render.saveLink(domToModel.get(document))\n  })\n\n  document.addEventListener('char-changed', event => {\n    let {player, char} = event.detail\n    save(name(player), char)\n\n    render.saveLink(domToModel.get(document))\n  })\n\n  //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n  // Build the page with default values\n\n  playersChanged()\n  eventTypeChanged()\n})\n"]}